syntax = "proto3";

package io.openfuture.chain.protocol;

option java_outer_classname = "CommunicationProtocol";


message Packet {
    Type type = 1;

    oneof body {
        HeartBeat heart_beat = 2;
        TimeSyncRequest time_sync_request = 3;
        TimeSyncResponse time_sync_response = 4;
        JoinNetworkRequest join_network_request = 5;
        JoinNetworkResponse join_network_response = 6;
        Connect connect = 7;
        Disconnect disconnect = 8;
        UpdateNetworkAddresses update_network_addresses = 9;
    }
}

enum Type {
    HEART_BEAT = 0;
    TIME_SYNC_REQUEST = 1;
    TIME_SYNC_RESPONSE = 2;
    JOIN_NETWORK_REQUEST = 4;
    JOIN_NETWORK_RESPONSE = 5;
    CONNECT = 6;
    DISCONNECT = 7;
    UPDATE_NETWORK_ADDRESSES = 8;
}

message HeartBeat {
    enum Type {
        PING = 0;
        PONG = 1;
    }

    Type type = 1;
}

message TimeSyncResponse {
    int64 node_timestamp = 1;
    int64 network_timestamp = 2;
}

message TimeSyncRequest {
    int64 node_timestamp = 1;
}

message NetworkAddress {
    string node_id = 1;
    string host = 2;
    int32 port = 3;
}

message JoinNetworkRequest {
    int32 port = 1;
}

message JoinNetworkResponse {
    string node_id = 1;
    string host = 2;
    repeated NetworkAddress network_addresses = 3;
}

message Connect {
    string node_id = 1;
}

message Disconnect {
    bool leave_network = 1;
}

message UpdateNetworkAddresses {
    enum Type {
        ADD = 0;
        REMOVE = 1;
    }

    message AddAddress {
        NetworkAddress address = 1;
    }

    message RemoveAddress {
        string node_id = 1;
    }

    Type type = 1;
    oneof operation {
        AddAddress add_address = 2;
        RemoveAddress remove_address = 3;
    }
}